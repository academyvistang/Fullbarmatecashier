@model BarAndRestaurantMate.Models.HotelMenuModel


@section scripts
{

    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    @*<script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>*@
    <!--Reference the autogenerated SignalR hub script. -->
    @*<script src="~/signalr/hubs"></script>*@
    <!--SignalR script to update the chat page and send messages.-->
    @*<script src="~/Scripts/automationconnection.js"></script>*@

    <script>
    $(function ()
    {
        function ReloadBind()
        {
            $(".ItemRemove").unbind('click');

            $(".ItemRemove").click(function ()
            {
                if (CanaddItemInt == 1)
                {
                    var id = $(this).parent().parent().attr("Id");

                    $(this).parent().parent().remove();
                    //itemId, int? quantity
                    $.ajax({
                        url: "/Guest/RemoveFromWaitressRequest/",
                        data: { id: id },
                        dataType: "json",
                        type: "POST",
                        error: function () {
                            alert("An error occurred.");
                        },
                        success: function (data)
                        {
                            if (data.CanRemoveItem == 1)
                            {
                                if (data.total == 0)
                                {
                                    $("#WaitressProcess").hide();
                                }
                                else
                                {
                                    $("#WaitressProcess").show();
                                }



                                var strRow = '<tr style="color:red;"><td></td><td colspan="2">Total</td><td>' + data.total + '</td></tr>';

                                var tab = "#CustomerItemsTable tr:last";

                                $(tab).remove();

                                $(tab).after(strRow);
                            }
                        }
                    });
                }
            });
        }

        $(".PlaceOrderBySelf").click(function ()
        {
            var canAddItem = 0;

            var id = $(this).attr("id");
            var strqty = "#quantity_" + id;
            var qty = $(strqty).val();
            var guestId = $("#GuestId").val();
            var tableId = $("#TableId").val();
            var guestOrderId = $("#GuestOrderId").val();
            var waitressId = $("#WaitressId").val();

            //itemId, int? quantity
            $.ajax({
                url: "@Url.Action("PlaceOrderBySelfAjax", "Guest")",
                data: { itemId: id, quantity: qty, guestId: guestId, tableId: tableId, guestOrderId: guestOrderId },
            dataType: "html",
            type: "POST",
            error: function ()
            {
                //alert("An error occurred.");
            },
            success: function (data)
            {
                $("#tableOrderDiv").html("");
                $("#tableOrderDiv").html(data);
                ReloadBind();
            }

        });

    });

        $("#CustomerPay").click(function ()
        {
            var r = confirm("You have indicated that the customer has paid in full. Please confirm.!");
            return r;
        });

        $("#SelfProcess").click(function () {
            var r = confirm("You have indicated that you want to move this request to an actual order. Please confirm.!");
            return r;
        });

        function ReloaAddRemoveButtons()
        {

            $(".ItemRemove").unbind('click');

            $(".ItemRemove").click(function ()
            {


                if (CanaddItemInt == 1)
                {
                    var id = $(this).parent().parent().attr("Id");

                    $(this).parent().parent().remove();
                    //itemId, int? quantity
                    $.ajax({
                        url: "/Guest/RemoveFromSelfRequest/",
                        data: { id: id },
                        dataType: "json",
                        type: "POST",
                        error: function () {
                            alert("An error occurred.");
                        },
                        success: function (data)
                        {
                            if (data.CanRemoveItem == 1)
                            {
                                if (data.total == 0)
                                {
                                    $("#SelfProcess").hide();
                                }
                                else {
                                    $("#SelfProcess").show();
                                }

                                var strRow = '<tr style="color:red;"><td></td><td colspan="2">Total</td><td>' + data.total + '</td></tr>';

                                var tab = "#CustomerItemsTable tr:last";

                                $(tab).remove();

                                $(tab).after(strRow);
                            }
                        }
                    });
                }
            });

            $(".PlaceOrderBySelf").click(function ()
            {
                var canAddItem = 0;

                var id = $(this).attr("id");
                var strqty = "#quantity_" + id;
                var qty = $(strqty).val();
                var guestId = $("#GuestId").val();
                var tableId = $("#TableId").val();
                var guestOrderId = $("#GuestOrderId").val();
                var waitressId = $("#WaitressId").val();

                //itemId, int? quantity
                $.ajax({
                    url: "@Url.Action("PlaceOrderBySelfAjax", "Guest")",
                    data: { itemId: id, quantity: qty, guestId: guestId, tableId: tableId, guestOrderId: guestOrderId },
                dataType: "html",
                type: "POST",
                error: function ()
                {
                    //alert("An error occurred.");
                },
                success: function (data)
                {
                    $("#tableOrderDiv").html("");
                    $("#tableOrderDiv").html(data);
                    ReloadBind();
                }

                });

            });

            $("#CustomerPay").click(function () {
                var r = confirm("You have indicated that the customer has paid in full. Please confirm.!");
                return r;
            });

            $("#WaitressProcess").click(function () {
                var r = confirm("You have indicated that you want to move this request to an order. Please confirm.!");
                return r;
            });
        }

        var CanaddItemInt = $("#CanaddItemInt").val();

        $(".ItemRemove").click(function ()
        {
            if (CanaddItemInt == 1)
            {
                var id = $(this).parent().parent().attr("Id");

                $(this).parent().parent().remove();
                //itemId, int? quantity
                $.ajax({
                    url: "/Guest/RemoveFromSelfRequest/",
                    data: { id: id },
                    async: false,
                    dataType: "json",
                    type: "POST",
                    error: function ()
                    {
                        alert("An error occurred.");
                    },
                    success: function (data)
                    {
                        if (data.CanRemoveItem == 1)
                        {
                            if (data.total == 0)
                            {
                                $("#SelfProcess").hide();
                            }
                            else {
                                $("#SelfProcess").show();
                            }

                            var strRow = '<tr style="color:red;"><td></td><td colspan="2">Total</td><td>' + data.total + '</td></tr>';

                            var tab = "#CustomerItemsTable tr:last";

                            $(tab).remove();

                            $(tab).after(strRow);
                        }
                    }
                });
            }
        });

        $('#Search').keydown(function (e) {

            if (e.keyCode == 13) {

                var Name = $(this).val();

                var canaddItemInt = $("#CanaddItemInt").val();
                var guestOrderId =  $("#GuestOrderId").val();

                $.ajax({
                    url: "@Url.Action("FilterByCategorySelfByName", "Guest")",
                    data: { name: Name, canaddItemInt: canaddItemInt, guestOrderId: guestOrderId },
                dataType: "html",
                type: "POST",
                error: function() {
                    alert("An error occurred.");
                },
                success: function (data)
                {
                    $("#menuItemsDiv").html("");
                    $("#menuItemsDiv").html(data);
                    //alert("Reloading()");
                    ReloaAddRemoveButtons();
                }
                });

            }
        });

        $('.smallCategorybox').click(function ()
            {
                var id = $(this).attr("id");

                var canaddItemInt = $("#CanaddItemInt").val();
                var guestOrderId =  $("#GuestOrderId").val();

                $.ajax({
                    url: "@Url.Action("FilterByCategorySelf", "Guest")",
                    data: { id: id, canaddItemInt: canaddItemInt, guestOrderId: guestOrderId },
                dataType: "html",
                type: "POST",
                error: function() {
                    alert("An error occurred.");
                },
                success: function (data)
                {
                    $("#menuItemsDiv").html("");
                    $("#menuItemsDiv").html(data);
                    ReloaAddRemoveButtons();
                }
                });
            });
    });
    </script>

}

<div class="twelve columns">

    @Html.Partial("_ViewMenuResponsiveOrderSelf")

    @Html.Hidden("GROUP", @User.Identity.Name + "#CUSTOMER#")
    @Html.Hidden("PERSONNAME", @User.Identity.Name)
    @Html.Hidden("TABLENUMBER", Model.TableId.ToString())
    @Html.Hidden("URL", @Url.Action("PlaceOrder", "Guest").ToString())
    @Html.Hidden("GuestId", Model.GuestId)
    @Html.Hidden("TableId", Model.TableId)
    @Html.Hidden("GuestOrderId", Model.GuestOrderId)
    @Html.Hidden("CanaddItemInt", Model.CanaddItemInt)
    @Html.Hidden("NewOrderPlaced", Model.NewOrderPlaced)
    @Html.Hidden("WaitressId", Model.WaitressId)
    @Html.Hidden("IamAWaitress", "0")
    @Html.Hidden("ExistingMember", "0")

</div>

@section PaginationBox
{
    @Html.Partial("_Pagination")
}








