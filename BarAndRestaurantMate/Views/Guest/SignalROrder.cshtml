@model BarAndRestaurantMate.Models.HotelMenuModel


@section scripts 
{
 
<!--Script references. -->
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->
@*<script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>*@
<!--Reference the autogenerated SignalR hub script. -->
@*<script src="~/signalr/hubs"></script>*@
<!--SignalR script to update the chat page and send messages.-->
@*<script src="~/Scripts/automationconnection.js"></script>*@

<script>

    $(function ()
    {
        var canaddItemInt = $("#CanaddItemInt").val();

        function ReloadBindAddButton()
        {
            $(".PlaceOrderCustomer").unbind('click');

            $(".PlaceOrderCustomer").click(function ()
            {

                var id = $(this).attr("id");
                var strqty = "#quantity_" + id;
                var qty = $(strqty).val();
                var guestId = $("#GuestId").val();
                var tableId = $("#TableId").val();
                var guestOrderId = $("#GuestOrderId").val();

                //itemId, int? quantity
                $.ajax({
                    url: "@Url.Action("PlaceOrderCustomerAjax", "Guest")",
                    data: { itemId: id, quantity: qty, guestId: guestId, tableId: tableId, guestOrderId: guestOrderId },
                dataType: "html",
                type: "POST",
                error: function ()
                {
                    //alert("An error occurred.");
                },
                success: function (data)
                {
                    $("#tableOrderDiv").html("");
                    $("#tableOrderDiv").html(data);
                    ReloadBind();
                }

            });
        });

    }

        function ReloadBind()
        {
            $(".ItemRemoveCustomer").unbind('click');

            $(".ItemRemoveCustomer").click(function ()
            {
                var canaddItemInt = $("#CanaddItemInt").val();

                var id = $(this).parent().parent().attr("Id");

                if (canaddItemInt == 1)
                {
                    $(this).parent().parent().remove();
                }

                $.ajax({
                    url: "/Guest/RemoveFromCustomerRequest/",
                    data: { id: id },
                    async: false,
                    dataType: "json",
                    type: "POST",
                    error: function ()
                    {
                        //alert("An error occurred.");
                    },
                    success: function (data)
                    {
                        //alert(data.CanRemoveItem);

                        if (data.CanRemoveItem == 1)
                        {
                            //$(this).parent().parent().remove();

                            if (data.total == 0)
                            {
                                $("#CustomerProcess").hide();
                            }
                            else
                            {
                                $("#CustomerProcess").show();
                            }

                            var strRow = '<tr style="color:red;"><td></td><td colspan="2">Total</td><td>' + data.total + '</td></tr>';

                            var tab = "#CustomerItemsTable tr:last";

                            $(tab).remove();

                            $(tab).after(strRow);
                        }
                    }
                });
            });
        }

        $(".ItemRemoveCustomer").click(function ()
        {
            var canaddItemInt = $("#CanaddItemInt").val();

            var id = $(this).parent().parent().attr("Id");

            if (canaddItemInt == 1)
            {
                $(this).parent().parent().remove();
            }
           

            $.ajax({
                url: "/Guest/RemoveFromCustomerRequest/",
                data: { id: id },
                async:false,
                dataType: "json",
                type: "POST",
                error: function ()
                {
                    //alert("An error occurred.");
                },
                success: function (data)
                {
                    //alert(data.CanRemoveItem);

                    if (data.CanRemoveItem == 1)
                    {
                        

                        if (data.total == 0)
                        {
                            $("#CustomerProcess").hide();
                        }
                        else
                        {
                            $("#CustomerProcess").show();
                        }

                        var strRow = '<tr style="color:red;"><td></td><td colspan="2">Total</td><td>' + data.total + '</td></tr>';

                        var tab = "#CustomerItemsTable tr:last";

                        $(tab).remove();

                        $(tab).after(strRow);
                    }
                }
            });
        });

        $(".PlaceOrderCustomer").click(function ()
        {

            var id = $(this).attr("id");
            var strqty = "#quantity_" + id;
            var qty = $(strqty).val();
            var guestId = $("#GuestId").val();
            var tableId = $("#TableId").val();
            var guestOrderId = $("#GuestOrderId").val();

            //itemId, int? quantity
            $.ajax({
                url: "@Url.Action("PlaceOrderCustomerAjax", "Guest")",
                data: { itemId: id, quantity: qty, guestId: guestId, tableId: tableId, guestOrderId: guestOrderId },
            dataType: "html",
            type: "POST",
            error: function ()
            {
                //alert("An error occurred.");
            },
            success: function (data)
            {
                $("#tableOrderDiv").html("");
                $("#tableOrderDiv").html(data);
                ReloadBind();
                ReloadBindAddButton();
            }

            });
        });

        

            $('.smallCategorybox').click(function ()
            {
                var id = $(this).attr("id");

                var canaddItemInt = $("#CanaddItemInt").val();

                var guestOrderId = $("#GuestOrderId").val();


                $.ajax({
                    url: "@Url.Action("FilterByCategoryCustomers", "Guest")",
                    data: { id: id, canaddItemInt: canaddItemInt, guestOrderId : guestOrderId },
                    //async:false,
                dataType: "html",
                type: "POST",
                error: function() {
                    alert("An error occurred.");
                },
                success: function (data)
                {
                    $("#menuItemsDiv").html("");
                    $("#menuItemsDiv").html(data);
                    //alert("Reloading");
                    ReloadBindAddButton();
                }
            });
        });
      
    
    });
</script>

}

<div class="twelve columns">

   @Html.Partial("_ViewMenuResponsiveOrder")

    @Html.Hidden("GROUP", @User.Identity.Name + "#CUSTOMER#")
    @Html.Hidden("PERSONNAME", @User.Identity.Name)
    @Html.Hidden("TABLENUMBER", Model.TableId.ToString())
    @Html.Hidden("URL", @Url.Action("PlaceOrder", "Guest").ToString())
    @Html.Hidden("GuestId", Model.GuestId)
    @Html.Hidden("TableId", Model.TableId)
    @Html.Hidden("GuestOrderId", Model.GuestOrderId)
    @Html.Hidden("CanaddItemInt", Model.CanaddItemInt)
    @Html.Hidden("NewOrderPlaced", Model.NewOrderPlaced)
    @Html.Hidden("WaitressId", Model.WaitressId)
    @Html.Hidden("IamAWaitress", "0")
    @Html.Hidden("ExistingMember", "0")

</div>

@section PaginationBox
{
    @Html.Partial("_Pagination")
}






