@model BarAndRestaurantMate.Models.HotelMenuModel

@{
    ViewBag.Title = "Booking";
}

@section scripts 
{
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->
@*<script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>*@
<!--Reference the autogenerated SignalR hub script. -->
@*<script src="~/signalr/hubs"></script>*@
<!--SignalR script to update the chat page and send messages.-->
@*<script src="~/Scripts/automationconnection.js"></script>*@


<script>
    $(function ()
    {

       
        $("#AnonymousTelephone").click(function (e) {

            $('#displaynumber').val(prompt('Please enter the guest tel number :', ''));
            var telNumber = $("#displaynumber").val();

            if (telNumber == "")
            {
                return false;
            }

            $.ajax({
                url: "@Url.Action("CreateNewUserSendText", "Guest")",
                data: { telNumber : telNumber },
            async:false,
            dataType: "json",
            type: "GET",
            error: function ()
            {
                alert("An error occurred new.");
            },
            success: function (data)
            {
                if (data.CreatedNewUser == 1)
                {
                    $("#REPLACEGUESTTELEPHONE").html("");
                    var strPersonUsrName = '<p> A text message has been sent to the guest. </p>';
                    $("#REPLACEGUESTTELEPHONE").html(strPersonUsrName);
                }
                else if (data.CreatedNewUser == 0)
                {
                    alert("Could not sucessfuly create guest as username has already been taken, please try another user name.");
                }
                else
                {
                    alert("Could not sucessfuly create a new person.");
                }
            }
        });
    });
       
        $("#AnonymousButton").click(function (e) {

            $('#displayname').val(prompt('Please enter the guest name :', ''));

            //$('#displaynumber').val(prompt('Please enter the guest number :', ''));


            var username = $("#displayname").val();
            //var telNumber = $("#displaynumber").val();
            var telNumber = "08105387515";


            if(username == "")
            {
                return false;
            }

            if (telNumber == "")
            {
                telNumber = "081";
            }

            $.ajax({
                url: "@Url.Action("CreateNewUser", "Guest")",
                data: { username: username, telNumber : telNumber },
                async:false,
            dataType: "json",
            type: "GET",
            error: function ()
            {
                alert("An error occurred new.");
            },
            success: function (data)
            {
                if (data.CreatedNewUser == 1)
                {
                    var items = "";

                    $.each(data.DropDownList, function (i, item)
                    {
                        items += "<option value=\"" + item.Value + "\">" + item.Text + "</option>";
                    });

                    $("#MemberId").html(items);
                    $("#ExistingTableMemberId").html(items);


                    $("#REPLACEGUESTCREDENTIALS").html("");
                    var strPersonUsrName = '<p> The Username and password for guest is ' + data.Username + '</p>';
                    $("#REPLACEGUESTCREDENTIALS").html(strPersonUsrName);
                }
                else if (data.CreatedNewUser == 0)
                {
                    alert("Could not sucessfuly create guest as username has already been taken, please try another user name.");
                }
                else
                {
                    alert("Could not sucessfuly create a new person.");
                }
            }
        });

            
        });

    });

</script>

 }

@if (Model.SendFinalConfirmation == 1)
{
   @Html.Hidden("GROUP", Model.GuestCredentials + "#CUSTOMER#")
}
else
{
    @Html.Hidden("GROUP", "WAITRESS")
}

@Html.Hidden("PERSONNAME", @User.Identity.Name)
@Html.Hidden("SENDFINALCONFIRMATION", Model.SendFinalConfirmation)
@Html.Hidden("TABLENUMBER", Model.TableId)
@Html.Partial("_ViewWaitressTables")